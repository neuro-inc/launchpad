# todo: we need to generate a unique suffix for each launchpad instance

appName: "launchpad"
dbPassword: "Passw0rd!123"  # todo: should we autogenerate this, or pass as arg ?

# todo: those two are used as a host names prefixes for ingress, probably should be autogenerated somehow?
launchpadHostPrefix: "launchpad"
keycloakHostPrefix: "launchpad-keycloak"

# todo: switch to env vars later
image:
  repository: "ghcr.io/neuro-inc/launchpad"
  tag: "latest"

replicas: 1
port: 8080

domain: "apps.dev.apolo.us"
netlifyDomain: "launchpad-web-ui-dev-apolo-us.netlify.app"

# apolo specific values
APOLO_PASSED_CONFIG: null
preset_name: cpu-medium
# apolo_app_id: app-id-12345

# application specific values example
LAUNCHPAD_INITIAL_CONFIG: >
  {
      "vllm": {
          "hugging_face_model": {
              "model_hf_name": "microsoft/DialoGPT-medium",
              "hf_token": null
          },
          "preset": {
              "name": "gpu-large"
          },
          "server_extra_args": [
              "--max-model-len=2048",
              "--gpu-memory-utilization=0.9"
          ]
      },
      "postgres": {
          "preset": {
              "name": "cpu-small"
          },
          "pg_bouncer": {
              "preset": {
                  "name": "cpu-small"
              }
          }
      },
      "text-embeddings": {
          "model": {
              "model_hf_name": "BAAI/bge-m3",
              "hf_token": null
          },
          "preset": {
              "name": "gpu-small"
          },
          "server_extra_args": []
      }
  }

postgresql:
  enabled: true
  fullnameOverride: launchpad-db
  auth:
    existingSecret: launchpad-db-secret
    username: postgres
    database: postgres
    password: ""   # not used for admin (use existingSecret)
    secretKeys:
      adminPasswordKey: "DB_PASSWORD"
      userPasswordKey: "DB_PASSWORD"
  primary:
    initdb:
      scripts:
        create_dbs.sql: |
          CREATE DATABASE keycloak;
          CREATE DATABASE launchpad;


keycloak:
  defaultRealm: "master" # internal variable
  replicas: 1
  auth:
    adminUser: "admin"
    adminPassword: "Passw0rd!123"  # todo: should be passed as an arg?
  postgresql:
    enabled: false
  externalDatabase:
    user: "postgres"
    database: "keycloak"
    existingSecret: "launchpad-db-secret"
    existingSecretHostKey: "DB_HOST"
    existingSecretPasswordKey: "DB_PASSWORD"
  proxy: "edge"
  readinessProbe:
    initialDelaySeconds: 60
    periodSeconds: 30
    failureThreshold: 5
  initContainers:
    - name: fetch-theme
      image: alpine/git:2.45.2
      imagePullPolicy: IfNotPresent
      command: [ "/bin/sh","-lc" ]
      args:
        - |
          set -euxo pipefail
          git clone --depth 1 --branch "keycloak-theme" "https://github.com/neuro-inc/launchpad.git" /tmp/repo
          mkdir -p "/opt/bitnami/keycloak/themes/apolo"
          cp -R "/tmp/repo/keycloak-theme/apolo/." "/opt/bitnami/keycloak/themes/apolo/"
          # Make sure the KC (1001) user can read the files
          chown -R 1001:0 /opt/bitnami/keycloak/themes
      volumeMounts:
        - name: empty-dir
          mountPath: /opt/bitnami/keycloak/themes
          subPath: app-themes-dir
      securityContext:
        runAsUser: 0
  extraStartupArgs: >-
    --spi-theme-static-max-age=-1 --spi-theme-cache-themes=false --spi-theme-cache-templates=false


